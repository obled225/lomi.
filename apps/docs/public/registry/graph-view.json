{
  "name": "graph-view",
  "description": "A graph to display relationships of all pages",
  "files": [
    {
      "content": "/* @proprietary license */\n\n'use client';\nimport {\n  lazy,\n  type RefObject,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport type {\n  ForceGraphMethods,\n  ForceGraphProps,\n  LinkObject,\n  NodeObject,\n} from 'react-force-graph-2d';\nimport { forceCollide, forceLink, forceManyBody } from 'd3-force';\nimport { useRouter } from 'fumadocs-core/framework';\n\nexport interface Graph {\n  links: Link[];\n  nodes: Node[];\n}\n\nexport type Node = NodeObject<NodeType>;\nexport type Link = LinkObject<NodeType, LinkType>;\n\nexport type NodeType = {\n  text: string;\n  description?: string;\n  neighbors?: string[];\n  url: string;\n};\nexport type LinkType = Record<string, unknown>;\n\nexport interface GraphViewProps {\n  graph: Graph;\n}\n\nconst ForceGraph2D = lazy(\n  () => import('react-force-graph-2d'),\n) as typeof import('react-force-graph-2d').default;\n\nexport function GraphView(props: GraphViewProps) {\n  const ref = useRef<HTMLDivElement>(null);\n  const [mount, setMount] = useState(false);\n  useEffect(() => {\n    setMount(true);\n  }, []);\n\n  return (\n    <div\n      ref={ref}\n      className=\"relative border h-[600px] [&_canvas]:size-full rounded-sm overflow-hidden\"\n    >\n      {mount && <ClientOnly {...props} containerRef={ref} />}\n    </div>\n  );\n}\n\nfunction ClientOnly({\n  containerRef,\n  graph: { nodes, links },\n}: GraphViewProps & { containerRef: RefObject<HTMLDivElement | null> }) {\n  const fgRef = useRef<ForceGraphMethods<Node, Link> | undefined>(undefined);\n  const hoveredRef = useRef<Node | null>(null);\n  const readyRef = useRef(false);\n  const router = useRouter();\n  const [tooltip, setTooltip] = useState<{\n    x: number;\n    y: number;\n    content: string;\n  } | null>(null);\n\n  useEffect(() => {\n    const fg = fgRef.current;\n    if (!fg) return;\n\n    if (readyRef.current) return;\n    readyRef.current = true;\n\n    fg.d3Force('link', forceLink().distance(200));\n    fg.d3Force('charge', forceManyBody().strength(1));\n    fg.d3Force('collision', forceCollide(60));\n  });\n\n  const handleNodeHover = (node: Node | null) => {\n    const graph = fgRef.current;\n    if (!graph) return;\n    hoveredRef.current = node;\n\n    if (node) {\n      const coords = graph.graph2ScreenCoords(node.x!, node.y!);\n      setTooltip({\n        x: coords.x + 4,\n        y: coords.y + 4,\n        content: node.description ?? 'No description',\n      });\n    } else {\n      setTooltip(null);\n    }\n  };\n\n  // Custom node rendering: circle with text label below\n  const nodeCanvasObject: ForceGraphProps['nodeCanvasObject'] = (node, ctx) => {\n    const container = containerRef.current;\n    if (!container) return;\n    const style = getComputedStyle(container);\n    const fontSize = 14;\n    const radius = 5;\n\n    // Draw circle\n    ctx.beginPath();\n    ctx.arc(node.x!, node.y!, radius, 0, 2 * Math.PI, false);\n\n    const hoverNode = hoveredRef.current;\n    const isActive =\n      hoverNode?.id === node.id ||\n      hoverNode?.neighbors?.includes(node.id as string);\n\n    ctx.fillStyle = isActive\n      ? style.getPropertyValue('--color-fd-primary')\n      : style.getPropertyValue('--color-purple-300');\n    ctx.fill();\n\n    // Draw text below the node\n    ctx.font = `${fontSize}px Sans-Serif`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillStyle = getComputedStyle(container).getPropertyValue('color');\n    ctx.fillText(node.text, node.x!, node.y! + radius + fontSize);\n  };\n\n  const linkColor = (link: Link) => {\n    const container = containerRef.current;\n    if (!container) return '#999';\n    const style = getComputedStyle(container);\n    const hoverNode = hoveredRef.current;\n\n    if (\n      hoverNode &&\n      typeof link.source === 'object' &&\n      typeof link.target === 'object' &&\n      (hoverNode.id === link.source.id || hoverNode.id === link.target.id)\n    ) {\n      return style.getPropertyValue('--color-fd-primary');\n    }\n\n    return `color-mix(in oklab, ${style.getPropertyValue('--color-fd-muted-foreground')} 50%, transparent)`;\n  };\n\n  // Enrich nodes with neighbors for hover effects\n  const enrichedNodes = useMemo(() => {\n    const enrichedNodes = nodes.map((node) => ({\n      ...node,\n      neighbors: links.flatMap((link) => {\n        if (link.source === node.id) return link.target;\n        if (link.target === node.id) return link.source;\n        return [];\n      }),\n    }));\n\n    return { nodes: enrichedNodes as NodeType[], links };\n  }, [nodes, links]);\n\n  return (\n    <>\n      <ForceGraph2D<NodeType, LinkType>\n        ref={fgRef}\n        graphData={enrichedNodes}\n        nodeCanvasObject={nodeCanvasObject}\n        linkColor={linkColor}\n        onNodeHover={handleNodeHover}\n        onNodeClick={(node) => {\n          router.push(node.url);\n        }}\n        linkWidth={2}\n        enableNodeDrag\n        enableZoomInteraction\n      />\n      {tooltip && (\n        <div\n          className=\"absolute bg-fd-popover text-fd-popover-foreground size-fit p-2 border rounded-sm shadow-sm text-sm max-w-xs\"\n          style={{ top: tooltip.y, left: tooltip.x }}\n        >\n          {tooltip.content}\n        </div>\n      )}\n    </>\n  );\n}\n",
      "type": "components",
      "path": "preview/graph-view.tsx"
    }
  ],
  "subComponents": [],
  "dependencies": {
    "react": null,
    "react-force-graph-2d": "^1.29.0",
    "d3-force": "^3.0.0",
    "fumadocs-core": null
  },
  "devDependencies": {}
}